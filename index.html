<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bud-E System</title>
    <script type="module" src="https://unpkg.com/@google/model-viewer@latest/dist/model-viewer.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="theme-toggle-container">
        <input type="checkbox" id="theme-toggle" class="theme-toggle">
        <label for="theme-toggle" class="toggle-label">
            <span class="toggle-slider"></span>
            <span class="toggle-icon sun-icon"></span>
            <span class="toggle-icon moon-icon"></span>
        </label>
    </div>

    <div class="viewer-container">
        <div class="viewer-item">
            <model-viewer id="viewer1" src="headie.glb" alt="Model 1" auto-reset auto-rotate camera-controls disable-pan exposure=".33" loading="lazy" reduction-scale="0.5"></model-viewer>
            <input type="color" id="color-picker1" value="#ffffff">
        </div>
        <div class="viewer-item">
            <model-viewer id="viewer2" src="pothead5.glb" alt="Model 2" auto-reset auto-rotate camera-controls disable-pan exposure=".33" loading="lazy" reduction-scale="0.5></model-viewer>
            <input type="color" id="color-picker2" value="#ffffff">
        </div>
    </div>

    <div id="product-details">
        <h2>Bud-E 001</h2>
        <p>Bud-E System innovations to help the fellow PotHead</p>
        <p><strong>Price: $99.99</strong></p>
        <button class="add-to-cart">Add to Cart</button>
    </div>

    <script>
        if (!document.createElement('model-viewer').constructor) {
            alert('Your browser does not support 3D models.');
        }
        
        // Theme Toggle Functionality
        document.getElementById('theme-toggle').addEventListener('change', function () {
            document.body.classList.toggle('dark-theme');
            document.body.classList.toggle('light-theme');
        });

        // Color Picker Functionality for Each Model Viewer
        document.getElementById('color-picker1').addEventListener('input', async function (event) {
            const viewer = document.getElementById('viewer1');
            await viewer.updateComplete;
            const model = viewer.model;
            if (model) {
                const color = hexToRgb(event.target.value);
                model.materials.forEach(material => {
                    material.pbrMetallicRoughness.setBaseColorFactor(color);
                });
            }
        });

        document.getElementById('color-picker2').addEventListener('input', async function (event) {
            const viewer = document.getElementById('viewer2');
            await viewer.updateComplete;
            const model = viewer.model;
            if (model) {
                const color = hexToRgb(event.target.value);
                model.materials.forEach(material => {
                    material.pbrMetallicRoughness.setBaseColorFactor(color);
                });
            }
        });

        // Convert HEX to RGB
        function hexToRgb(hex) {
            hex = hex.replace(/^#/, '');
            let r = parseInt(hex.substring(0, 2), 16) / 255;
            let g = parseInt(hex.substring(2, 4), 16) / 255;
            let b = parseInt(hex.substring(4, 6), 16) / 255;
            return [r, g, b, 1]; // RGBA format
        }
    </script>
</body>
</html>
