<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bud-E System</title>
    <script type="module" src="https://unpkg.com/@google/model-viewer@latest/dist/model-viewer.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="light-theme">
    <div class="theme-toggle-container">
        <input type="checkbox" id="theme-toggle" class="theme-toggle">
        <label for="theme-toggle" class="toggle-label">
            <span class="toggle-slider"></span>
            <span class="toggle-icon sun-icon">‚òÄÔ∏è</span>
            <span class="toggle-icon moon-icon">üåô</span>
        </label>
    </div>

    <div class="viewer-container">
        <div class="viewer-item">
            <model-viewer id="viewer1" src="headie.glb" alt="Model 1" auto-reset auto-rotate camera-controls disable-pan exposure=".33" loading="lazy" reduction-scale="0.5"></model-viewer>
            <input type="color" id="color-picker1" value="#ffffff">
        </div>
        <div class="viewer-item">
            <model-viewer id="viewer2" src="pothead5.glb" alt="Model 2" auto-reset auto-rotate camera-controls disable-pan exposure=".33" loading="lazy" reduction-scale="0.5></model-viewer>
            <input type="color" id="color-picker2" value="#ffffff">
        </div>
    </div>

    <div id="product-details">
        <h2>Bud-E 001</h2>
        <p>Bud-E System innovations to help the fellow PotHead</p>
        <p><strong>Price: $99.99</strong></p>
        <button class="add-to-cart">Add to Cart</button>
    </div>

    <script>
        (function() {
            // Theme Management
            const themeToggle = document.getElementById('theme-toggle');
            const savedTheme = localStorage.getItem('theme') || 'light-theme';
            
            document.body.className = savedTheme;
            themeToggle.checked = savedTheme === 'dark-theme';

            themeToggle.addEventListener('change', function() {
                const isDark = this.checked;
                document.body.classList.toggle('dark-theme', isDark);
                document.body.classList.toggle('light-theme', !isDark);
                localStorage.setItem('theme', isDark ? 'dark-theme' : 'light-theme');
            });

            // Model Color Management
            function createColorHandler(viewerId) {
                return async function(event) {
                    const viewer = document.getElementById(viewerId);
                    await viewer.updateComplete;
                    
                    if (viewer.model) {
                        const color = hexToRgb(event.target.value);
                        // Target only the base material (adjust index as needed)
                        const baseMaterial = viewer.model.materials[0];
                        baseMaterial.pbrMetallicRoughness.setBaseColorFactor(color);
                    }
                };
            }

            // Initialize color pickers
            document.getElementById('color-picker1').addEventListener('input', 
                createColorHandler('viewer1'));
            
            document.getElementById('color-picker2').addEventListener('input', 
                createColorHandler('viewer2'));

            // Error Handling
            document.querySelectorAll('model-viewer').forEach(viewer => {
                viewer.addEventListener('error', (event) => {
                    console.error('Model loading error:', event.detail);
                    alert('Error loading 3D model. Please try refreshing the page.');
                });
            });

            // Utility function
            function hexToRgb(hex) {
                const bigint = parseInt(hex.slice(1), 16);
                return [
                    (bigint >> 16) & 255,
                    (bigint >> 8) & 255,
                    bigint & 255,
                    255
                ].map(x => x / 255);
            }

            // Initial theme setup
            if (!document.createElement('model-viewer').constructor) {
                alert('Your browser does not support 3D models. Please try a modern browser.');
            }
        })();
    </script>
</body>
</html>